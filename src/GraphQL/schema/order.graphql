extend type Query {
    listOrder: [Order]
        @can(ability: "viewAny" model: "MayIFit\\Extension\\Shop\\Models\\Order") 
        @paginate(type: "paginator")

    getOrderFromToken(token: String!): Order @field(resolver: "GetOrderFromToken@resolve")

    viewOrder(
        id: ID! @eq
    ): Order! 
        @can(ability: "view" find: "id") 
        @find

}

extend type Mutation @guard(with: ["sanctum"]) {
    updateOrder(input: UpdateOrderInput! @spread): Order 
        @can(ability: "update" find: "id") 
        @update

    deleteOrder(id: ID! @rules(apply: ["required"])): Order 
        @can(ability: "delete" find: "id") 
        @delete
}

extend type Mutation {
    createOrder(input: CreateOrderInput! @spread): Order 
        @create
}

input UpdateOrderInput {
    id: ID!
    token: String!
    customer: UpdateCustomerRelation @spread
    products: syncProductsRelation @spread
    orderStatus: connectOrderStatusRelation
    discount_percentage: Float
    extra_information: String
    paid: Boolean
}

input CreateOrderInput {
    customer: UpdateCustomerRelation!
    products: syncProductsRelation!
    extra_information: String
    paid: Boolean
}

input UpdateCustomerRelation {
    connect: ID
    create: CreateCustomerInput
}

input syncProductsRelation {
    sync: [syncProductPivotRelationData!]!
}

input syncProductPivotRelationData {
    id: ID!
    quantity: Int!
}

type Order @modelClass(class: "\\MayIFit\\Extension\\Shop\\Models\\Order") {
    id: ID!
    customer: Customer @belongsTo
    orderStatus: OrderStatus @belongsTo
    token: String!
    placed: DateTime!
    products: [Product!]! @belongsToMany
    quantity: Int!
    net_value: Float!
    gross_value: Float!
    discount_percentage: Float
    extra_information: String
    paid: Boolean
}